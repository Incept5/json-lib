jdk:
  - openjdk21
before_install:
  - ./gradlew clean
install:
  # Extract version from git tag (JitPack sets the version based on the git tag)
  - if [ -n "$VERSION" ]; then
      echo "Using provided version from JitPack: $VERSION";
    elif [ -n "$(git tag --points-at HEAD)" ]; then
      VERSION=$(git describe --tags --abbrev=0 | sed 's/^v//');
      echo "Using git tag version: $VERSION";
    else
      VERSION=$(git rev-parse --short HEAD);
      echo "Using commit hash as version: $VERSION";
    fi
  
  # Check if this is a SNAPSHOT version - if so, skip JitPack build
  - if [[ "$VERSION" == *"-SNAPSHOT" ]]; then
      echo "SNAPSHOT versions are not published to JitPack. Skipping build.";
      exit 0;
    fi
  
  - echo "Building release version $VERSION"
  - ./gradlew build publishToMavenLocal -Pversion=$VERSION
  - echo "Published artifacts to local Maven repository"
  - find ~/.m2/repository -name "json-lib*" | grep "com/github/incept5" | sort
  - echo "Artifacts should be available at: https://jitpack.io/com/github/incept5/json-lib/$VERSION/"